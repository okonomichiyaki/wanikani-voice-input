(()=>{function t(t){return t&&t.__esModule?t.default:t}const e={Category:"span.quiz-input__question-category",Type:"span.quiz-input__question-type",Prompt:"div.character-header__characters",LessonMeaning:"div.character-header__meaning",Synonyms:"#quiz-user-synonyms script",Subjects:'#quiz-queue > script[data-quiz-queue-target="subjects"]',Next:"div.quiz-input__input-container button"};function n(){const t=document.querySelector(e.Type);return t?t.textContent.trim().toLowerCase():null}function r(){const t=n();return"meaning"===t||"name"===t?"en-US":"reading"===t?"ja-JP":"en-US"}function o(){const t=document.querySelector(e.Prompt);if(!t)return null;let n=t.textContent;return""===n&&t.childNodes.length>0&&t.childNodes[0].getAttribute("aria-label")&&(n=t.childNodes[0].getAttribute("aria-label").toLowerCase()),""===n?null:n}function i(){return{prompt:o(),category:function(){const t=document.querySelector(e.Category);return t?t.textContent.trim().toLowerCase():null}(),type:n()}}function c(t){const n=document.querySelector(e.Synonyms);if(n){const e=JSON.parse(n.textContent);if(e[t])return e[t]}return[]}function a(){const t=document.querySelector(e.Next);return!!t&&(t.click(),!0)}function u(){s("en-US"===r()?"aaa":"あああ")}function s(t){return function(t){const e=document.querySelector("#user-response");e&&(e.value=t)}(t),a()}function f(){const t=document.getElementById("information");if(!t)return!0;return!new Array(t.classList).some((t=>t.toString().includes("open")))}function l(){const t=document.querySelectorAll("#additional-content a");for(let e of t)if(e.textContent.includes("Item Info"))return void(f()&&e.click())}function p(t){return null===t?"null":t!==Object(t)?typeof t:{}.toString.call(t).slice(8,-1).toLowerCase()}function d(t){return"string"!==p(t)||!t.length}function h(t="",e,n){if(d(t))return!1;const r=t.charCodeAt(0);return e<=r&&r<=n}const g={HIRAGANA:"toHiragana",KATAKANA:"toKatakana"},y="hepburn",m={useObsoleteKana:!1,passRomaji:!1,upcaseKatakana:!1,IMEMode:!1,convertLongVowelMark:!0,romanization:y},b=65,w=90,v=12353,j=12438,k=12449,O=12540,S=19968,A=40879,C=12540,E=12539,_=[65313,65338],x=[65345,65370],z=[65377,65381],M=[[12288,12351],z,[12539,12540],[65281,65295],[65306,65311],[65339,65343],[65371,65376],[65504,65518]],N=[...[[12352,12447],[12448,12543],z,[65382,65439]],...M,_,x,[65296,65305],[19968,40959],[13312,19903]],q=[[0,127],[256,257],[274,275],[298,299],[332,333],[362,363]],L=[[32,47],[58,63],[91,96],[123,126],[8216,8217],[8220,8221]];function R(t=""){return N.some((([e,n])=>h(t,e,n)))}function I(t="",e){const n="regexp"===p(e);return!d(t)&&[...t].every((t=>{const r=R(t);return n?r||e.test(t):r}))}var T=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function $(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(r=t[n],o=e[n],!(r===o||T(r)&&T(o)))return!1;var r,o;return!0}function J(t,e){void 0===e&&(e=$);var n=null;function r(){for(var r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];if(n&&n.lastThis===this&&e(r,n.lastArgs))return n.lastResult;var i=t.apply(this,r);return n={lastResult:i,lastArgs:r,lastThis:this},i}return r.clear=function(){n=null},r}var K=Object.prototype.hasOwnProperty;function W(t,e,n){for(n of t.keys())if(F(n,e))return n}function F(t,e){var n,r,o;if(t===e)return!0;if(t&&e&&(n=t.constructor)===e.constructor){if(n===Date)return t.getTime()===e.getTime();if(n===RegExp)return t.toString()===e.toString();if(n===Array){if((r=t.length)===e.length)for(;r--&&F(t[r],e[r]););return-1===r}if(n===Set){if(t.size!==e.size)return!1;for(r of t){if((o=r)&&"object"==typeof o&&!(o=W(e,o)))return!1;if(!e.has(o))return!1}return!0}if(n===Map){if(t.size!==e.size)return!1;for(r of t){if((o=r[0])&&"object"==typeof o&&!(o=W(e,o)))return!1;if(!F(r[1],e.get(o)))return!1}return!0}if(n===ArrayBuffer)t=new Uint8Array(t),e=new Uint8Array(e);else if(n===DataView){if((r=t.byteLength)===e.byteLength)for(;r--&&t.getInt8(r)===e.getInt8(r););return-1===r}if(ArrayBuffer.isView(t)){if((r=t.byteLength)===e.byteLength)for(;r--&&t[r]===e[r];);return-1===r}if(!n||"object"==typeof t){for(n in r=0,t){if(K.call(t,n)&&++r&&!K.call(e,n))return!1;if(!(n in e)||!F(t[n],e[n]))return!1}return Object.keys(e).length===r}}return t!=t&&e!=e}const U=(t={})=>Object.assign({},m,t);function V(t,e,n){const r=e;function o(t,e){const n=t.charAt(0);return i(Object.assign({"":n},r[n]),t.slice(1),e,e+1)}function i(t,e,r,c){if(!e)return n||1===Object.keys(t).length?t[""]?[[r,c,t[""]]]:[]:[[r,c,null]];if(1===Object.keys(t).length)return[[r,c,t[""]]].concat(o(e,c));const a=function(t,e){if(void 0!==t[e])return Object.assign({"":t[""]+e},t[e])}(t,e.charAt(0));return void 0===a?[[r,c,t[""]]].concat(o(e,c)):i(a,e.slice(1),r,c+1)}return o(t,0)}function B(t){return Object.entries(t).reduce(((t,[e,n])=>{const r="string"===p(n);return t[e]=r?{"":n}:B(n),t}),{})}function P(t,e){return e.split("").reduce(((t,e)=>(void 0===t[e]&&(t[e]={}),t[e])),t)}function D(t={}){const e={};return"object"===p(t)&&Object.entries(t).forEach((([t,n])=>{let r=e;t.split("").forEach((t=>{void 0===r[t]&&(r[t]={}),r=r[t]})),r[""]=n})),function(t){return function t(e,n){return void 0===e||"string"===p(e)?n:Object.entries(n).reduce(((n,[r,o])=>(n[r]=t(e[r],o),n)),e)}(JSON.parse(JSON.stringify(t)),e)}}function G(t,e){return e?"function"===p(e)?e(t):D(e)(t):t}const H={a:"あ",i:"い",u:"う",e:"え",o:"お",k:{a:"か",i:"き",u:"く",e:"け",o:"こ"},s:{a:"さ",i:"し",u:"す",e:"せ",o:"そ"},t:{a:"た",i:"ち",u:"つ",e:"て",o:"と"},n:{a:"な",i:"に",u:"ぬ",e:"ね",o:"の"},h:{a:"は",i:"ひ",u:"ふ",e:"へ",o:"ほ"},m:{a:"ま",i:"み",u:"む",e:"め",o:"も"},y:{a:"や",u:"ゆ",o:"よ"},r:{a:"ら",i:"り",u:"る",e:"れ",o:"ろ"},w:{a:"わ",i:"ゐ",e:"ゑ",o:"を"},g:{a:"が",i:"ぎ",u:"ぐ",e:"げ",o:"ご"},z:{a:"ざ",i:"じ",u:"ず",e:"ぜ",o:"ぞ"},d:{a:"だ",i:"ぢ",u:"づ",e:"で",o:"ど"},b:{a:"ば",i:"び",u:"ぶ",e:"べ",o:"ぼ"},p:{a:"ぱ",i:"ぴ",u:"ぷ",e:"ぺ",o:"ぽ"},v:{a:"ゔぁ",i:"ゔぃ",u:"ゔ",e:"ゔぇ",o:"ゔぉ"}},Q={".":"。",",":"、",":":"：","/":"・","!":"！","?":"？","~":"〜","-":"ー","‘":"「","’":"」","“":"『","”":"』","[":"［","]":"］","(":"（",")":"）","{":"｛","}":"｝"},X={k:"き",s:"し",t:"ち",n:"に",h:"ひ",m:"み",r:"り",g:"ぎ",z:"じ",d:"ぢ",b:"び",p:"ぴ",v:"ゔ",q:"く",f:"ふ"},Y={ya:"ゃ",yi:"ぃ",yu:"ゅ",ye:"ぇ",yo:"ょ"},Z={a:"ぁ",i:"ぃ",u:"ぅ",e:"ぇ",o:"ぉ"},tt={sh:"sy",ch:"ty",cy:"ty",chy:"ty",shy:"sy",j:"zy",jy:"zy",shi:"si",chi:"ti",tsu:"tu",ji:"zi",fu:"hu"},et=Object.assign({tu:"っ",wa:"ゎ",ka:"ヵ",ke:"ヶ"},Z,Y),nt={yi:"い",wu:"う",ye:"いぇ",wi:"うぃ",we:"うぇ",kwa:"くぁ",whu:"う",tha:"てゃ",thu:"てゅ",tho:"てょ",dha:"でゃ",dhu:"でゅ",dho:"でょ"},rt={wh:"う",kw:"く",qw:"く",q:"く",gw:"ぐ",sw:"す",ts:"つ",th:"て",tw:"と",dh:"で",dw:"ど",fw:"ふ",f:"ふ"};function ot(){const t=B(H),e=e=>P(t,e);function n(t){return Object.entries(t).reduce(((t,[e,r])=>(t[e]=e?n(r):`っ${r}`,t)),{})}return Object.entries(X).forEach((([t,n])=>{Object.entries(Y).forEach((([r,o])=>{e(t+r)[""]=n+o}))})),Object.entries(Q).forEach((([t,n])=>{e(t)[""]=n})),Object.entries(rt).forEach((([t,n])=>{Object.entries(Z).forEach((([r,o])=>{e(t+r)[""]=n+o}))})),["n","n'","xn"].forEach((t=>{e(t)[""]="ん"})),t.c=JSON.parse(JSON.stringify(t.k)),Object.entries(tt).forEach((([t,n])=>{const r=t.slice(0,t.length-1),o=t.charAt(t.length-1);e(r)[o]=JSON.parse(JSON.stringify(e(n)))})),Object.entries(et).forEach((([t,n])=>{const r=t=>t.charAt(t.length-1),o=t=>t.slice(0,t.length-1),i=e(`x${t}`);i[""]=n;var c;e(`l${o(t)}`)[r(t)]=i,(c=t,[...Object.entries(tt),["c","k"]].reduce(((t,[e,n])=>c.startsWith(n)?t.concat(c.replace(n,e)):t),[])).forEach((n=>{["l","x"].forEach((i=>{e(i+o(n))[r(n)]=e(i+t)}))}))})),Object.entries(nt).forEach((([t,n])=>{e(t)[""]=n})),[...Object.keys(X),"c","y","w","j"].forEach((e=>{const r=t[e];r[e]=n(r)})),delete t.n.n,Object.freeze(JSON.parse(JSON.stringify(t)))}let it=null;const ct=D({wi:"ゐ",we:"ゑ"});function at(t=""){return!d(t)&&h(t,b,w)}function ut(t=""){return!d(t)&&t.charCodeAt(0)===C}function st(t=""){return!d(t)&&t.charCodeAt(0)===E}function ft(t=""){return!d(t)&&(!!ut(t)||h(t,v,j))}function lt(t=""){const e=[];return t.split("").forEach((t=>{if(ut(t)||st(t))e.push(t);else if(ft(t)){const n=t.charCodeAt(0)+(k-v),r=String.fromCharCode(n);e.push(r)}else e.push(t)})),e.join("")}const pt=J(((t,e,n)=>{let r=(null==it&&(it=ot()),it);return r=t?function(t){const e=JSON.parse(JSON.stringify(t));return e.n.n={"":"ん"},e.n[" "]={"":"ん"},e}(r):r,r=e?ct(r):r,n&&(r=G(r,n)),r}),F);function dt(t="",e={},n){let r;return n?r=e:(r=U(e),n=pt(r.IMEMode,r.useObsoleteKana,r.customKanaMapping)),function(t="",e={},n){const{IMEMode:r,useObsoleteKana:o,customKanaMapping:i}=e;n||(n=pt(r,o,i));return V(t.toLowerCase(),n,!r)}(t,r,n).map((e=>{const[n,o,i]=e;if(null===i)return t.slice(n);const c=r.IMEMode===g.HIRAGANA,a=r.IMEMode===g.KATAKANA||[...t.slice(n,o)].every(at);return c||!a?i:lt(i)})).join("")}function ht(t=""){return!d(t)&&q.some((([e,n])=>h(t,e,n)))}function gt(t="",e){const n="regexp"===p(e);return!d(t)&&[...t].every((t=>{const r=ht(t);return n?r||e.test(t):r}))}function yt(t=""){return h(t,k,O)}function mt(t=""){return!d(t)&&[...t].every(ft)}function bt(t=""){return!d(t)&&[...t].every(yt)}function wt(t=""){return h(t,S,A)}function vt(t=""){return!d(t)&&[...t].every(wt)}function jt(t="",e={passKanji:!0}){const n=[...t];let r=!1;return e.passKanji||(r=n.some(vt)),(n.some(mt)||n.some(bt))&&n.some(gt)&&!r}const kt=(t,e)=>ut(t)&&e<1,Ot=(t,e)=>ut(t)&&e>0,St=t=>["ヶ","ヵ"].includes(t),At={a:"あ",i:"い",u:"う",e:"え",o:"う"};function Ct(t="",e,{isDestinationRomaji:n,convertLongVowelMark:r}={}){let o="";return t.split("").reduce(((i,c,a)=>{if(st(c)||kt(c,a)||St(c))return i.concat(c);if(r&&o&&Ot(c,a)){const r=e(o).slice(-1);return yt(t[a-1])&&"o"===r&&n?i.concat("お"):i.concat(At[r])}if(!ut(c)&&yt(c)){const t=c.charCodeAt(0)+(v-k),e=String.fromCharCode(t);return o=e,i.concat(e)}return o="",i.concat(c)}),[]).join("")}let Et=null;const _t={"あ":"a","い":"i","う":"u","え":"e","お":"o","か":"ka","き":"ki","く":"ku","け":"ke","こ":"ko","さ":"sa","し":"shi","す":"su","せ":"se","そ":"so","た":"ta","ち":"chi","つ":"tsu","て":"te","と":"to","な":"na","に":"ni","ぬ":"nu","ね":"ne","の":"no","は":"ha","ひ":"hi","ふ":"fu","へ":"he","ほ":"ho","ま":"ma","み":"mi","む":"mu","め":"me","も":"mo","ら":"ra","り":"ri","る":"ru","れ":"re","ろ":"ro","や":"ya","ゆ":"yu","よ":"yo","わ":"wa","ゐ":"wi","ゑ":"we","を":"wo","ん":"n","が":"ga","ぎ":"gi","ぐ":"gu","げ":"ge","ご":"go","ざ":"za","じ":"ji","ず":"zu","ぜ":"ze","ぞ":"zo","だ":"da","ぢ":"ji","づ":"zu","で":"de","ど":"do","ば":"ba","び":"bi","ぶ":"bu","べ":"be","ぼ":"bo","ぱ":"pa","ぴ":"pi","ぷ":"pu","ぺ":"pe","ぽ":"po","ゔぁ":"va","ゔぃ":"vi","ゔ":"vu","ゔぇ":"ve","ゔぉ":"vo"},xt={"。":".","、":",","：":":","・":"/","！":"!","？":"?","〜":"~","ー":"-","「":"‘","」":"’","『":"“","』":"”","［":"[","］":"]","（":"(","）":")","｛":"{","｝":"}","　":" "},zt=["あ","い","う","え","お","や","ゆ","よ"],Mt={"ゃ":"ya","ゅ":"yu","ょ":"yo"},Nt={"ぃ":"yi","ぇ":"ye"},qt={"ぁ":"a","ぃ":"i","ぅ":"u","ぇ":"e","ぉ":"o"},Lt=["き","に","ひ","み","り","ぎ","び","ぴ","ゔ","く","ふ"],Rt={"し":"sh","ち":"ch","じ":"j","ぢ":"j"},It={"っ":"","ゃ":"ya","ゅ":"yu","ょ":"yo","ぁ":"a","ぃ":"i","ぅ":"u","ぇ":"e","ぉ":"o"},Tt={b:"b",c:"t",d:"d",f:"f",g:"g",h:"h",j:"j",k:"k",m:"m",p:"p",q:"q",r:"r",s:"s",t:"t",v:"v",w:"w",x:"x",z:"z"};function $t(){return null==Et&&(Et=function(){const t=B(_t),e=e=>P(t,e),n=(t,n)=>{e(t)[""]=n};return Object.entries(xt).forEach((([t,n])=>{e(t)[""]=n})),[...Object.entries(Mt),...Object.entries(qt)].forEach((([t,e])=>{n(t,e)})),Lt.forEach((t=>{const r=e(t)[""][0];Object.entries(Mt).forEach((([e,o])=>{n(t+e,r+o)})),Object.entries(Nt).forEach((([e,o])=>{n(t+e,r+o)}))})),Object.entries(Rt).forEach((([t,e])=>{Object.entries(Mt).forEach((([r,o])=>{n(t+r,e+o[1])})),n(`${t}ぃ`,`${e}yi`),n(`${t}ぇ`,`${e}e`)})),t["っ"]=Jt(t),Object.entries(It).forEach((([t,e])=>{n(t,e)})),zt.forEach((t=>{n(`ん${t}`,`n'${e(t)[""]}`)})),Object.freeze(JSON.parse(JSON.stringify(t)))}()),Et}function Jt(t){return Object.entries(t).reduce(((t,[e,n])=>{if(e)t[e]=Jt(n);else{const r=n.charAt(0);t[e]=Object.keys(Tt).includes(r)?Tt[r]+n:n}return t}),{})}const Kt=J(((t,e)=>{let n=function(t){return t===y?$t():{}}(t);return e&&(n=G(n,e)),n}),F);function Wt(t="",e={},n){const r=U(e);return n||(n=Kt(r.romanization,r.customRomajiMapping)),function(t,e,n){n||(n=Kt(e.romanization,e.customRomajiMapping));const r=Object.assign({},{isDestinationRomaji:!0},e);return V(Ct(t,Wt,r),n,!e.IMEMode)}(t,r,n).map((e=>{const[n,o,i]=e;return r.upcaseKatakana&&bt(t.slice(n,o))?i.toUpperCase():i})).join("")}function Ft(t=""){return!d(t)&&L.some((([e,n])=>h(t,e,n)))}function Ut(t="",e={}){const n=U(e);if(n.passRomaji)return Ct(t,Wt,n);if(jt(t,{passKanji:!0})){return dt(Ct(t,Wt,n).toLowerCase(),n)}return gt(t)||Ft(t)?dt(t.toLowerCase(),n):Ct(t,Wt,n)}var Vt={};function Bt(t){let e=t.length;for(let n=Math.floor(e/2);n>0;n--)if(e%n==0){let r=!0,o=t.slice(0,n);for(let i=n;i<e;i+=n)if(t.slice(i,i+n)!==o){r=!1;break}if(r)return o}return null}function Pt(t,e){const n=t[e];return n||[]}Vt=function(){function t(t,e,n,r,o){return t<e||n<e?t>n?n+1:t+1:r===o?e:e+1}return function(e,n){if(e===n)return 0;if(e.length>n.length){var r=e;e=n,n=r}for(var o=e.length,i=n.length;o>0&&e.charCodeAt(o-1)===n.charCodeAt(i-1);)o--,i--;for(var c=0;c<o&&e.charCodeAt(c)===n.charCodeAt(c);)c++;if(i-=c,0===(o-=c)||i<3)return i;var a,u,s,f,l,p,d,h,g,y,m,b,w=0,v=[];for(a=0;a<o;a++)v.push(a+1),v.push(e.charCodeAt(c+a));for(var j=v.length-1;w<i-3;)for(g=n.charCodeAt(c+(u=w)),y=n.charCodeAt(c+(s=w+1)),m=n.charCodeAt(c+(f=w+2)),b=n.charCodeAt(c+(l=w+3)),p=w+=4,a=0;a<j;a+=2)u=t(d=v[a],u,s,g,h=v[a+1]),s=t(u,s,f,y,h),f=t(s,f,l,m,h),p=t(f,l,p,b,h),v[a]=p,l=f,f=s,s=u,u=d;for(;w<i;)for(g=n.charCodeAt(c+(u=w)),p=++w,a=0;a<j;a+=2)d=v[a],v[a]=p=t(d,u,p,g,v[a+1]),u=d;return p}}();const Dt={b:"び",ezone:"いぞん",gt:"じき",g:"じ",ec2:"いしつ","ec 2":"いしつ",ec:"いし",agar:"あがる",ol:"おえる",ob:"おび",k:"けい",c:"し",cd:"しり",ck:"しけい",y:"わい",uber:"うば",hulu:"ふる",canyou:"かんゆう",2:"つ",3:"さん",5:"ご",9:"きゅう",10:"じゅ",x:"じゅ",1e3:"せん","ワーく":"わく","西国":"さいこく","帰って":"かえって","を呼ぶ":"およぶ","掌蹠":"しょうせき","件名":"けんめい","加藤":"かとう","貨物線":"かもつせん","短足":"たんそく","5回":"ごかい","けえき":"けいき","覗いて":"のぞいて","廃病":"はいびょう","正観":"せいかん","借りに":"かりに","全開":"ぜんかい","九大":"きゅうだい","最速":"さいそく"};function Gt(t){return t.flatMap((t=>"word"===t.type?t.kana.map(Ut):"character"===t.type?t.readings.map((t=>{let e=t.value;return e.includes(".")&&(e=e.split(".")[0]),Ut(e)})):[]))}function Ht(t,e){return Xt(t.data)===Xt(e)?e:null}function Qt(t,e){const n=t.data;for(const t of e)if(t===n||t===Dt[n.toLowerCase()])return t;return null}function Xt(t){return t.toLowerCase().replaceAll(" ","")}function Yt(e,n){const r=e.data;for(const e of n){if(Xt(e)===Xt(r))return e;if(t(Vt)(Xt(e),Xt(r))<2)return e}return null}function Zt(t){return{error:!0,message:t}}function te(t,e){return{success:!0,message:"correct answer",candidate:t,answer:e}}function ee(t,n){const r=function(){const t=document.querySelector(e.Subjects);if(!t)return null;const n=JSON.parse(t.textContent),r={};for(const t of n){if(t.primary_reading_type){const e=t[t.primary_reading_type].map((function(t){return{reading:t}}));t.readings=e}"Radical"===t.type&&(t.readings=[]);const e=c(t.id);t.meanings.push(...e);const n=[t.id,t.characters];for(const e of t.meanings)n.push(e.toLowerCase());for(const e of n)r[e]||(r[e]=[]),r[e].push(t)}return r}(),i=o();if(!i)return Zt("failed to find flashcard prompt");const a=r[i];if(!a||a.length<1)return Zt(`failed to find item: ${i}`);const u=[],s=[];for(const t of a){t.readings&&u.push(...t.readings.map((t=>t.reading))),s.push(...t.meanings);const e=c(t.id);s.push(...e)}let f=[];if(f.push({type:"raw",data:n}),I(n)){let e=Ut(n);if(e!==n&&f.push({type:"hiragana",data:e}),e.endsWith("する")){const n=Gt(Pt(t,e.substring(0,e.length-2))).map((t=>t+"する"));for(let t of n)f.push({type:"する",data:t})}else{const n=Gt(Pt(t,e));for(let t of n)f.push({type:"dictionary",data:t})}const r=Bt(e);r&&f.push({type:"repeating",data:r})}let l={error:!1,message:"incorrect answer"};for(const t of f){const e=Yt(t,s),n=Qt(t,u),r=Ht(t,i);n?l=te(t,n):e?l=te(t,e):r&&u.length>0&&(l=te(t,u[0]))}return l.candidates=f,l.meanings=s,l.readings=u,l}function ne(t,e){if(!("webkitSpeechRecognition"in window))return console.error("[wanikani-voice-input] web speech not supported by this browser!"),null;const n=new webkitSpeechRecognition;return n.continuous=!0,n.interimResults=!0,n.lang=t,n.onresult=t=>{for(let n=t.resultIndex;n<t.results.length;++n){const r=t.results[n][0].transcript.trim(),o=t.results[n].isFinal;e(r,o)}},n.onerror=t=>{"no-speech"!==t.error&&console.error("[wanikani-voice-input] error occurred in recognition:",t.error)},n.onend=()=>{n.start()},n}function re(t,e){t.lang!=e&&(t.stop(),t.lang=e)}function oe(){return ie().lightning}function ie(){return unsafeWindow.wkof?unsafeWindow.wkof.settings["wanikani-voice-input"]:{lightning:!0,transcript:!0,transcript_background:"#ffd700",transcript_foreground:"#000000",transcript_position:"top"}}function ce(t){let e=t.transcript_position,n="width: 100%; position: absolute; display: flex; align-items: center; justify-content: center; pointer-events: none;";return"top"===e||"bottom"===e?n+=` ${e}: 0px`:"center"===e&&(n+=" top: 45vh"),n}function ae(t){return`color: ${t.transcript_foreground}; background-color: ${t.transcript_background}; font-size: 5vh;`}function ue(t){const e=document.createElement("div");e.id="wanikani-voice-input-transcript-container",e.style=ce(t);const n=document.createElement("p");n.style=ae(t),e.appendChild(n),document.body.appendChild(e)}function se(t,e){if(!t.transcript)return;document.querySelector("div#wanikani-voice-input-transcript-container").style=ce(t);const n=document.querySelector("div#wanikani-voice-input-transcript-container p");n.style=ae(t);n.textContent.startsWith(e)&&""!==e||(n.textContent=e)}function fe(t,e,n){t[e]||(t[e]=[]),t[e].push(n)}function le(){let t=JSON.parse(GM_getResourceText("jmdict")),e=JSON.parse(GM_getResourceText("kanjidic2")),n={};for(const[e,r]of Object.entries(t))fe(n,e,r);for(const[t,r]of Object.entries(e))fe(n,t,r);const r=Object.keys(n).length;return console.log(`[wanikani-voice-input] got dictionary with ${r} entries`),n}function pe(){!function(){for(const t of Object.keys(e))document.querySelector(e[t])||console.error(`[wanikani-voice-input] failed to find ${t}: ${e[t]}`)}();!function(t){ue(ie());let e="Flipping",n=i();function o(t){console.log(`[wanikani-voice-input] >> ${t}`),e=t}function c(){a(),o("Flipping")}const f={wrong:u,incorrect:u,mistake:u,"不正解":u,"ふせいかい":u,"間違い":u,"まちがい":u,"だめ":u,"ダメ":u,next:c,"つぎ":c,"次":c,NEXT:c,"ねくすと":c,"ネクスト":c},p=ne(r(),(function(n,r){console.log("[wanikani-voice-input]",i());let c=function(t,e,n,r,o){let i=e,c=null,a=null,u=!1,s=r;if("Ready"===e){let e=ee(t,r);console.log("[wanikani-voice-input]",r,e),e.candidate&&s!==e.candidate.data&&(s+=` (${e.candidate.data})`),e.success?o?(i="Flipping",c=e.answer):(i="Waiting",c=e.answer):e.error&&(s="!! "+e.message+" !!")}"Waiting"===e&&o&&(i="Flipping",u=oe());"Ready"===e&&o&&n[r]&&(a=n[r]);return{newState:i,transcript:s,answer:c,command:a,lightning:u}}(t,e,f,n,r);se(ie(),c.transcript),e!==c.newState&&o(c.newState),c.answer&&s(c.answer),c.lightning&&setTimeout(a,100),c.command&&c.command()}));function d(t,c){const a=r();re(p,a);const u=function(t){const e=i();return t.prompt!==e.prompt||t.category!==e.category||t.type!==e.type}(n);"Flipping"===e&&u&&(o("Ready"),n=u,se(ie(),""))}const h={attributes:!0,childList:!0,subtree:!0};new MutationObserver(d).observe(document.body,h),window.addEventListener("didAnswerQuestion",(function(t){!function(t){if("object"!=typeof t.detail||"object"!=typeof t.detail.results)return console.error("[wanikani-voice-input] didAnswerCorrectly got unexpected event, WaniKani code change?",t),!1;const e=t.detail.results;return t.detail,"string"!=typeof e.action?(console.error("[wanikani-voice-input] didAnswerCorrectly got unexpected event, WaniKani code change?",t),!1):"pass"===e.action}(t)?oe()&&setTimeout(l,100):"Ready"===e&&(e="Flipping",oe()&&setTimeout(a,100))})),p.start(),e="Ready"}(le())}unsafeWindow.wkof?function(t,e){function n(){new t.Settings({script_id:"wanikani-voice-input",title:"Voice Input",content:{lightning:{type:"checkbox",label:"Lightning mode",default:!0,hover_tip:"If enabled, automatically advance to the next flashcard on correct answers. If enabled, please disable lightning mode from any other scripts."},transcript:{type:"checkbox",label:"Live transcript",default:!0,hover_tip:"If enabled, displays a live transcript of dictation"},transcript_background:{type:"color",label:"Transcript background color",hover_tip:"Background color for the live transcript",default:"#ffd700"},transcript_foreground:{type:"color",label:"Transcript text color",hover_tip:"Text color for the live transcript",default:"#000000"},transcript_position:{type:"dropdown",label:"Transcript position",hover_tip:"Position on the page for the live transcript",default:"top",content:{top:"Top",bottom:"Bottom"}}}}).open()}t.include("Menu,Settings"),t.ready("Menu,Settings").then((function(){t.Menu.insert_script_link({name:"wanikani-voice-input",submenu:"Settings",title:"Voice Input",on_click:n})})).then((function(){return t.Settings.load("wanikani-voice-input")})).then(e)}(unsafeWindow.wkof,pe):(console.log("[wanikani-voice-input] wkof not found?"),pe())})();
//# sourceMappingURL=app.js.map
